<ChatScreen>:
    MDBoxLayout:
        orientation: 'vertical'
        md_bg_color: app.theme_cls.bg_normal
        MDBoxLayout:
            size_hint_y: None
            height: dp(50)
            spacing: dp(5)
            md_bg_color: app.theme_cls.bg_normal
            padding: [0, 0, 10, 0]
            MDIconButton:
                icon: 'arrow-left'
                theme_text_color: 'Custom'
                text_color: app.theme_cls.opposite_bg_normal
                user_font_size: dp(18)
                size_hint: None, None
                pos_hint: {'center_y': .5}
                size: dp(30), dp(30)
                padding: 0
                on_press: app.change_screen('message') 
            MDBoxLayout:
                size_hint: None, None
                size: dp(30), dp(30)
                orientation: 'vertical'
                pos_hint: {'center_y': .5}
                Avatar:
                    source: root.image
                    size: dp(30), dp(30)
                    size_hint: None, None
            MDBoxLayout:
                orientation: 'vertical'
                padding: [0, 10, 0, 10]
                Label:
                    text: root.text
                    size: self.texture_size
                    size_hint: None, None
                    font_size: sp(17)
                    color: app.theme_cls.opposite_bg_normal
                    bold: True
                MDBoxLayout:
                    size_hint_x: None
                    spacing: dp(5)
                    MDIcon: 
                        icon: 'circle'
                        theme_text_color: 'Custom'
                        color: [0, 1, 0, 1] if root.active == True else [.5, .5, .5, 1]
                        font_size: sp(10)
                        size: dp(10), dp(10)
                        size_hint: None, None
                    Label: 
                        text: 'Active' if root.active == True else 'Offline'
                        size: self.texture_size
                        size_hint: None, None
                        font_size: sp(10)
                        color: app.theme_cls.opposite_bg_normal

            
            MDBoxLayout:
                size_hint_x: None
                spacing: dp(5)
                MDIconButton:
                    icon: 'video-outline'
                    theme_text_color: 'Custom'
                    text_color: app.theme_cls.primary_color
                    user_font_size: sp(16)
                    size_hint: None, None
                    pos_hint: {'center_y': .5}
                    size: dp(30), dp(30)
                    padding: dp(0)
                    md_bg_color: app.theme_cls.bg_darkest if app.theme_cls.theme_style == 'Light' else app.theme_cls.bg_dark

                MDIconButton:
                    icon: 'phone-outline'
                    theme_text_color: 'Custom'
                    text_color: app.theme_cls.primary_color
                    user_font_size: sp(16)
                    size_hint: None, None
                    pos_hint: {'center_y': .5}
                    size: dp(30), dp(30)
                    padding: dp(0)
                    md_bg_color: app.theme_cls.bg_darkest if app.theme_cls.theme_style == 'Light' else app.theme_cls.bg_dark

                MDIconButton:
                    icon: 'dots-vertical'
                    theme_text_color: 'Custom'
                    text_color: app.theme_cls.primary_color
                    user_font_size: sp(16)
                    size_hint: None, None
                    pos_hint: {'center_y': .5}
                    size: dp(30), dp(30)
                    padding: dp(0)
                    md_bg_color: app.theme_cls.bg_darkest if app.theme_cls.theme_style == 'Light' else app.theme_cls.bg_dark

        ScrollView:
            MDList:
                id: msgHistory
                spacing: dp(5)
                padding: [0, 10, 0, 10]
                ChatBubble:

        MDBoxLayout:
            padding: [10, ]
            spacing: dp(5)
            size_hint_y: None
            height: dp(40)
            md_bg_color: app.theme_cls.bg_normal
            TextField:
            MDIconButton:
                size_hint: None, None
                icon: 'send'
                elevation: 0
                user_font_size: sp(16)
                theme_text_color: 'Custom'
                text_color: [1, 1, 1, 1]
                md_bg_color: app.theme_cls.accent_color

                #Rotating the send button
                canvas.before:
                    PushMatrix
                    Rotate:
                        angle: 45
                        origin: self.center 
                        canvas.after:
                            PopMatrix